[include shell_command.cfg]
[include macros/speedtest.cfg]
[include calibrate.cfg]
[include ercf/ercf_hardware.cfg]
[include ercf/ercf_software.cfg]
[include RatOS/boards/btt-octopus-11/config.cfg]
[include RatOS/printers/base.cfg]

[beacon]
serial: /dev/beacon
x_offset: 0 
y_offset: -20.676
mesh_main_direction: x
mesh_runs: 1
speed: 15.
lift_speed: 80.

[resonance_tester]
accel_chip: beacon

[neopixel panel_ring]
pin:                     PB0
chain_count:             16
initial_RED: 1
initial_GREEN: 1
initial_BLUE: 1

[temperature_sensor chamber]
sensor_type: PT1000
sensor_pin: PF5
min_temp: -20
max_temp: 120
gcode_id: C

[heater_bed]
heater_pin: heater_bed_heating_pin
sensor_pin: heater_bed_sensor_pin
sensor_type: Generic 3950
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.02 # 50hz for european AC, to avoid flickering lights.


[heater_fan toolhead_cooling_fan]
pin: fan_toolhead_cooling_pin
fan_speed: 1

[fan]
pin: !fan_part_cooling_pin
cycle_time: 0.00004

[controller_fan MeinLuefter]
pin: !fan_controller_board_pin
cycle_time: 0.00004

[printer]
kinematics: corexy
max_velocity: 1000
max_accel: 15000
max_accel_to_decel: 7500
max_z_velocity: 20
max_z_accel: 150
square_corner_velocity: 5

[include RatOS/homing.cfg]
[include macros.cfg]
[include RatOS/shell-macros.cfg]

[include RatOS/printers/v-core-3/steppers.cfg]

[include RatOS/printers/v-core-3/speed-limits-performance.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-x.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-y.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z1.cfg]
[include RatOS/steppers/ldo/42sth48-2504ac/2209/24v-1.1a-z2.cfg]

[safe_z_home]
home_xy_position: 250, 250
z_hop: 3

[bed_mesh]
speed: 200
zero_reference_position: 250, 250
mesh_min: 15,-20.676
mesh_max:490,430
probe_count: 100,100
mesh_pps: 0,0
move_check_distance: 5
split_delta_z: .025

[z_tilt]
z_positions:
	0,0
	250,500
	500,0

points:
	60,60  #60,60
	250,440
	440,60
		
horizontal_move_z: 20
retries: 10
retry_tolerance: 0.02

[include RatOS/printers/v-core-3/physical-endstop-x.cfg]
[include RatOS/printers/v-core-3/physical-endstop-y.cfg]

[extruder]
nozzle_diameter: 0.4 
dir_pin: e_dir_pin # Remove ! in front of pin name to reverse extruder direction
heater_pin: e_heater_pin
sensor_type: PT1000 #ATC Semitec 104GT-2
sensor_pin: e_sensor_pin
min_extrude_temp: 170
min_temp: 0
max_temp: 350







[firmware_retraction]
retract_speed: 120
unretract_extra_length: 0
unretract_speed: 120
retract_length: 0.3

[pause_resume]
recover_velocity: 300.0

[include RatOS/printers/v-core-3/input-shaper.cfg]

[input_shaper]
shaper_freq_x: 61.6
shaper_type_x:mzv
shaper_freq_y:32.8
shaper_type_y:mzv





#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"
variable_macro_travel_speed: 300
variable_z_probe: "static"


#############################################################################################################
### PRINTER CONFIGURATION
### Customize the defaults to your specific build
#############################################################################################################
[stepper_x]
dir_pin: x_dir_pin # Add ! in front of pin name to reverse X stepper direction
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
position_max: 500
position_endstop: 0

[stepper_y]
dir_pin: y_dir_pin # Add ! in front of pin name to reverse Y stepper direction
rotation_distance: 40 # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
position_max: 500
position_min: -28
position_endstop: 500

[stepper_z]
dir_pin: !z0_dir_pin # Add ! in front of pin name to reverse Z stepper direction
rotation_distance: 4 # 4 for TR8*4 lead screws
homing_retract_dist: 0
position_max: 500
position_min: -8

[stepper_z1]
dir_pin: !z1_dir_pin # Add ! in front of pin name to reverse Z1 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[stepper_z2]
dir_pin: !z2_dir_pin # Add ! in front of pin name to reverse Z2 direction
rotation_distance: 4 # 4 for TR8*4 lead screws

[extruder]
rotation_distance: 4.637
full_steps_per_rotation: 200
filament_diameter: 1.750
max_extrude_only_velocity: 120
max_extrude_only_distance: 500
max_extrude_cross_section: 50.0





[tmc2209 stepper_x]
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper_y]
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper_z]
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper_z1]
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper_z2]
stealthchop_threshold: 0
interpolate: False

[tmc2209 extruder]
uart_pin: e_uart_pin
run_current: 0.707
stealthchop_threshold: 0
interpolate: False
driver_TBL: 1
driver_TOFF: 3
driver_HEND: 9
driver_HSTRT: 7
sense_resistor: 0.11

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.436306897764236,
#*# 	1.773123409161051,
#*# 	0.8011358298122535,
#*# 	0.48910962582399903,
#*# 	0.3445905632579279,
#*# 	0.029493386050518017,
#*# 	-0.18189167435185488,
#*# 	0.042143057726527135,
#*# 	0.19855040309618815,
#*# 	0.06952676083860955
#*# model_domain = 1.8223523372393517e-07,1.933959020146507e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 63.359773
#*# model_offset = 0.11500
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 24.715
#*# pid_ki = 1.458
#*# pid_kd = 104.731
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.131
#*# pid_ki = 2.474
#*# pid_kd = 497.057
